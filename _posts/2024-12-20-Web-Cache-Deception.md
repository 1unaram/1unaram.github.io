---
title: "[PortSwigger] Academy: Web Cache Deception"
date: 2024-12-20 00:00:00
categories: [Study, PortSwigger]
tags: [webhacking, portswigger]
published: False
---

> [[PortSwigger Academy Web Cache Deception](https://portswigger.net/web-security/learning-paths/web-cache-deception)] μ„ μκ°•ν•κ³  μ •λ¦¬ν•μ€μµλ‹λ‹¤.
> {: .prompt-info }

<br><br>

# #Web Caches

---

μ›Ή μΊμ‹λ” μ„λ²„μ™€ μ‚¬μ©μ μ‚¬μ΄μ— μ΅΄μ¬ν•λ” μ‹μ¤ν…μ΄λ‹¤. ν΄λΌμ΄μ–ΈνΈκ°€ μ •μ  λ¦¬μ†μ¤λ¥Ό μ”μ²­ν•λ©΄, μ”μ²­μ€ κ°€μ¥ λ¨Όμ € μΊμ‹λ΅ ν–¥ν•΄μ§„λ‹¤. λ§μ•½ μΊμ‹κ°€ λ¦¬μ†μ¤μ— λ€ν• μΉ΄ν”Όκ°€ μ—†λ‹¤λ©΄(Cache Miss), μ”μ²­μ€ μ‘λ‹µν•λ” μ„λ²„λ΅ λ³΄λ‚΄μ§„λ‹¤. κ·Έ λ‹¤μ μ‘λ‹µμ€ μ‚¬μ©μμ—κ² μ „λ‹¬λκΈ° μ΄μ „μ— μΊμ‹λ΅ μ „λ‹¬λκ³ , μΊμ‹λ” μ‘λ‹µμ„ μ €μ¥ν• μ§€ κ²°μ •ν•λ” λ―Έλ¦¬ κµ¬μ„±λ μΌλ ¨μ λ£°(Cache Rule)μ„ μ΄μ©ν•μ—¬ μ‘λ‹µμ„ μ €μ¥ν•κ±°λ‚ μ €μ¥ν•μ§€ μ•μ€ λ‹¤μμ— μ‚¬μ©μμ—κ² μ „λ‹¬ λλ‹¤.

<br>

λ§μ•½ μΊμ‹κ°€ μ‘λ‹µμ„ μ €μ¥ν–λ‹¤λ©΄, λ™μΌν• μ •μ μΈ λ¦¬μ†μ¤μ— λ€ν• μ”μ²­μ΄ λ‚μ¤‘μ— λ§λ“¤μ–΄μ§ λ• μΊμ‹λ” μ €μ¥λ μ‘λ‹µμ μΉ΄ν”Όλ¥Ό μ‚¬μ©μμ—κ² κ³§λ°”λ΅ μ κ³µν•λ‹¤(Cache Hit).

<br>

![image](https://github.com/user-attachments/assets/a0cf9f01-a522-4992-a4c8-b9655679b752)

<br>

μΊμ‹±ν•λ” κ²ƒμ€ μ›Ή μ½ν…μΈ λ¥Ό μ „λ‹¬ν•λ” μΈ΅λ©΄μ—μ„ μ μ  ν”ν•΄μ§€κ³  μ¤‘μ”ν•΄μ§€λ”λ°, μ „ μ„Έκ³„μ—μ„ μ κ³µλλ” μ„λ²„μ— μ €μ¥λμ–΄ μλ” μ½ν…μΈ μ μΉ΄ν”Όλ¥Ό μΊμ‹±ν•λ” λ°μ— μ‚¬μ©λλ” Content Delivery Networks(CDNs)μ μ‚¬μ©μ—μ„ νΉν κ·Έλ ‡λ‹¤. CDNsλ” λ°μ΄ν„° μ΄λ™ κ±°λ¦¬λ¥Ό μµμ†ν™”ν•¨μΌλ΅μ¨ λ΅λ“ν•λ” μ‹κ°„μ„ μ¤„μ—¬ μ‚¬μ©μμ™€ κ°€μ¥ κ°€κΉμ΄ μ„λ²„λ΅λ¶€ν„° μ½ν…μΈ λ¥Ό μ κ³µν•κ² λμ–΄ μ „λ‹¬ μ†λ„λ¥Ό ν–¥μƒ μ‹ν‚¨λ‹¤.

<br>
<br>

## Cache keys

μΊμ‹λ” HTTP μ”μ²­μ„ λ°›μ„ λ•, κ³§λ°”λ΅ μ „λ‹¬ν•  μ μλ” μΊμ‹±λ μ‘λ‹µμ΄ μ΅΄μ¬ν•λ”μ§€ νΉμ€ μ›λμ μ„λ²„λ΅ κ³§λ°”λ΅ μ”μ²­μ„ λ³΄λ‚΄μ•Όλ§ ν•λ”μ§€λ¥Ό κ²°μ •ν•΄μ•Ό ν•λ‹¤. μΊμ‹λ” HTTP μ”μ²­μ μ”μ†λ΅λ¶€ν„° **cache key**λΌλ” κ²ƒμ„ μƒμ„±ν•¨μΌλ΅μ¨ μ΄ κ²°μ •μ„ λ‚΄λ¦°λ‹¤. μΌλ°μ μΌλ΅ μ΄λ” URL κ²½λ΅μ™€ μΏΌλ¦¬ νλΌλ―Έν„°λ¥Ό ν¬ν•¨ν•κ³  μμΌλ‚, ν—¤λ”μ™€ μ½ν…μΈ  νƒ€μ…κ³Ό κ°™μ€ λ‹¤λ¥Έ λ‹¤μ–‘ν• μ”μ†λ¥Ό ν¬ν•¨ν•κΈ°λ„ ν•λ‹¤.

λ§μΌ λ“¤μ–΄μ¨ μ”μ²­μ μΊμ‹ ν‚¤κ°€ μ΄μ „ μ”μ²­μ μΊμ‹ ν‚¤μ™€ λ§¤μΉλλ‹¤λ©΄, μΊμ‹λ” κ·Έλ“¤μ„ λ™λ“±ν•λ‹¤κ³  λ³΄κ³  μΊμ‹±λ μ‘λ‹µμ μΉ΄ν”Όλ¥Ό μ κ³µν•λ‹¤.

<br>

## Cache rules

μΊμ‹ λ£°μ€ μ–΄λ–¤ κ²ƒμ΄ μΊμ‹±λκ³  μ–Όλ§λ‚ μ¤λ μ΅΄μ¬ν•΄μ•Ό ν•λ”μ§€λ¥Ό κ²°μ •ν•λ‹¤. μΊμ‹ λ£°μ€ μΌλ°μ μΌλ΅ μμ£Ό λ°”λ€μ§€ μ•κ³  λ‹¤μμ νμ΄μ§€μ—μ„ μ¬μ‚¬μ©λλ” μ •μ μΈ λ¦¬μ†μ¤λ“¤μ„ μ €μ¥ν•κΈ° μ„ν•΄ μ„Έν…λλ‹¤. λ™μ μΈ μ½ν…μΈ λ” μ‚¬μ©μκ°€ κ°€μ¥ μµμ‹ μ λ°μ΄ν„°λ¥Ό μ„λ²„λ΅λ¶€ν„° λ°”λ΅ μ–»μ„ μ μλ„λ΅ ν•λ©° λ―Όκ°ν• μ •λ³΄λ¥Ό ν¬ν•¨ν•κ³¤ ν•κΈ° λ•λ¬Έμ— μΊμ‹±λμ§€ μ•λ”λ‹¤. Web Cache Deception κ³µκ²©μ€ μΊμ‹ λ£°μ΄ μ μ©λλ” λ°©λ²•μ„ κ³µκ²©ν•κΈ°μ— λ‹¤μ–‘ν• νƒ€μ…μ λ£°μ„ μ•„λ” κ²ƒμ΄ μ¤‘μ”ν•λ°, νΉν μ”μ²­μ URL κ²½λ΅μ—μ„ μ •ν•΄μ Έ μλ” λ¬Έμμ—΄μ„ κΈ°λ°μΌλ΅ ν•λ” κ²½μ°λ¥Ό ν¬ν•¨ν•λ‹¤.

<br>

μλ¥Ό λ“¤μ–΄

- μ •μ μΈ νμΌ ν™•μ¥μ λ£° : `.css` νΉμ€ `.js`μ™€ κ°™μ΄ μ”μ²­λ λ¦¬μ†μ¤μ νμΌ ν™•μ¥μλ¥Ό λ§¤μΉν•λ‹¤.
- μ •μ μΈ λ””λ ‰ν„°λ¦¬ λ£° : νΉμ •ν• prefixλ΅ μ‹μ‘ν•λ” λ¨λ“  URL κ²½λ΅λ¥Ό λ§¤μΉν•λ‹¤. μ΄λ” μ£Όλ΅ `/static`μ΄λ‚ `/assets`μ™€ κ°™μ΄ μ¤λ΅μ§€ μ •μ μΈ λ¦¬μ†μ¤λ§μ„ ν¬ν•¨ν•κ³  μλ” νΉμ •ν• νƒ€κ² λ””λ ‰ν† λ¦¬λ¥Ό μ„ν•΄ μ‚¬μ©λλ‹¤.
- νμΌ μ΄λ¦„ λ£° : `robots.txt`μ™€ `favicon.ico`μ™€ κ°™μ΄ μ›Ή μ΄μμ—μ„ κΈ€λ΅λ²ν•κ² μ”μ²­λκ³  κ±°μ λ³€ν•μ§€ μ•λ” νΉμ •ν• νμΌ μ΄λ¦„μ„ νƒ€κ² νμΌλ΅ λ§¤μΉν•λ‹¤.

<br><br>

# #Constructing a web cache deception attack

---

μΌλ°μ μΌλ΅ λ§ν•κΈ°λ¥Ό, κΈ°λ³Έ web cache deception κ³µκ²©μ€ λ‹¤μκ³Ό κ°™μ€ μ¤ν…μ„ ν¬ν•¨ν•κ³  μλ‹¤.

1. λ―Όκ°ν• μ •λ³΄λ¥Ό ν¬ν•¨ν•λ” λ™μ μΈ μ‘λ‹µμ„ λ¦¬ν„΄ν•λ” νƒ€κ² μ—”λ“ν¬μΈνΈλ¥Ό μ°Ύμ•„λ‚Έλ‹¤. λ λ”λ§λ νμ΄μ§€μ—μ„λ” λ―Όκ°ν• μ •λ³΄κ°€ λ³΄μ΄μ§€ μ•μ„ μ μκΈ° λ•λ¬Έμ— Brup Suiteμ—μ„ μ‘λ‹µμ„ μ΅°μ‚¬ν•λ‹¤. μ›λ³Έ μ„λ²„μ μƒνƒλ¥Ό λ³€κ²½ν•λ” μ”μ²­μ€ μΌλ°μ μΌλ΅ μΊμ‹± λμ§€ μ•κΈ° λ•λ¬Έμ— `GET`, `HEAD`, `OPTIONS` λ©”μ†λ“λ¥Ό μ§€μ›ν•λ” μ—”λ“ν¬μΈνΈμ— ν¬μ»¤μ‹±ν•λ‹¤.

2. μΊμ‹μ™€ μ›λ³Έ μ„λ²„κ°€ URL κ²½λ΅λ¥Ό νμ‹±ν•λ” λ°©λ²• λ‚΄μ—μ„ λ¨μμ„ μ°Ύμ•„λ‚Έλ‹¤. μ—¬κΈ°μ„ λ¨μμ€ URLμ„ λ¦¬μ†μ¤μ— λ§¤ν•‘ν•κΈ°, κµ¬λ¶„ κΈ°νΈ λ¬Έμ μ²λ¦¬, κ²½λ΅ μ •κ·ν™”μ™€ κ°™μ€ λ°©λ²• λ‚΄μ—μ„ μ΅΄μ¬ν•  μ μλ‹¤.

3. λ¨μμ„ μ΄μ©ν•μ—¬ μΊμ‹λ¥Ό μ†μ—¬ λ™μ  μ‘λ‹µμ„ μ €μ¥ν•λ„λ΅ ν•λ” μ•…μ„± URLμ„ λ§λ“ λ‹¤. ν”Όν•΄μκ°€ URLμ— μ ‘κ·Όν•  λ•, μ‘λ‹µμ΄ μΊμ‹μ— μ €μ¥λλ‹¤. Burpλ¥Ό μ΄μ©ν•΄μ„ λ™μΌν• URLμ΄ ν”Όν•΄μμ λ°μ΄ν„°λ¥Ό ν¬ν•¨ν•κ³  μλ” μΊμ‹±λ μ‘λ‹µμ„ κ°€μ Έμ¤λ„λ΅ μ”μ²­μ„ λ³΄λ‚Ό μ μλ‹¤. μ·¨μ•½μ μ„ μ¨κΈΈ μ μλ” μ„Έμ…μ΄λ‚ μ ν¨ν•μ§€ μ•μ€ λ΅μ»¬ λ°μ΄ν„° μ—†μ΄ μ‚¬μ©μλ¥Ό λ¦¬λ‹¤μ΄λ ‰νΈ ν•  μ μκΈ° λ•λ¬Έμ— λΈλΌμ°μ €μ—μ„ μ§μ ‘μ μΌλ΅ μ΄λ¥Ό ν•λ©΄ μ•λλ‹¤.

<br>

## Using a cache buster

μ·¨μ•½μ μ„ ν…μ¤νΈν•κ³  web cache deception κ³µκ²©μ„ μ§„ν–‰ν•λ” λ™μ•, μ°λ¦¬κ°€ λ³΄λ‚΄λ” κ° μ”μ²­μ΄ λ‹¤λ¥Έ μΊμ‹ ν‚¤λ¥Ό κ°€μ§€κ³  μλ„λ΅ ν•΄μ•Όν•λ‹¤. κ·Έλ ‡μ§€ μ•μΌλ©΄, ν…μ¤νΈ κ²°κ³Όμ— μν–¥μ„ λΌμΉλ” μΊμ‹±λ μ‘λ‹µμ„ λ°›μ„ μ μκΈ° λ•λ¬Έμ΄λ‹¤.

URL κ²½λ΅μ™€ μ–΄λ– ν• μΏΌλ¦¬ νλΌλ―Έν„°λ“ μ§€ λ¨λ‘ μΌλ°μ μΌλ΅ μΊμ‹ ν‚¤λ¥Ό ν¬ν•¨ν•κ³  μκΈ° λ•λ¬Έμ—, μΏΌλ¦¬ μ¤νΈλ§μ„ κ²½λ΅μ— μ¶”κ°€ν•κ³  μ”μ²­μ„ λ³΄λ‚Ό λ•¨λ§λ‹¤ μ΄λ¥Ό λ°”κΏμΌλ΅μ¨ ν‚¤λ¥Ό λ°”κΏ€ μ μλ‹¤. **Param Miner** ν™•μ¥μλ¥Ό μ΄μ©ν•μ—¬ μ΄ κ³Όμ •μ„ μλ™ν™”ν•  μ μλ‹¤. μ΄λ¥Ό ν•κΈ° μ„ν•΄μ„λ” λ¨Όμ € ν•΄λ‹Ή ν™•μ¥μ„ μ„¤μΉν•κ³ , μƒλ‹¨μ _Param Miner > Settings_ λ©”λ‰΄λ¥Ό ν΄λ¦­ν•κ³ , *Add dynamic cachebuster*λ¥Ό μ„ νƒν•λ©΄ λλ‹¤. μ΄μ  Burpλ” νΉμ •ν• μΏΌλ¦¬ μ¤νΈλ§μ„ λ§¤ μ”μ²­μ— μ¶”κ°€ν•  μ μλ‹¤. μ¶”κ°€λ μΏΌλ¦¬ μ¤νΈλ§μ€ _Logger_ νƒ­μ—μ„ ν™•μΈν•  μ μλ‹¤.

<br>

## Detecting cached responses

ν…μ¤νΈλ¥Ό ν•λ” λ™μ•, μΊμ‹±λ μ‘λ‹µμ„ μ‹λ³„ν•  μ¤„ μ•„λ” κ²ƒμ΄ μ¤‘μ”ν•λ‹¤. μ΄λ¥Ό μ„ν•΄μ„λ” μ‘λ‹µ ν—¤λ”μ™€ μ‘λ‹µ μ‹κ°„μ„ λ³΄λ©΄ λλ‹¤.

<br>

λ‹¤μ–‘ν• μ‘λ‹µ ν—¤λ”κ°€ μ‘λ‹µμ΄ μΊμ‹± λμ—λ‹¤λ” κ²ƒμ„ κ°€λ¦¬ν‚¨λ‹¤. μλ¥Ό λ“¤μ–΄,

- `X-Cache` ν—¤λ”λ” μ‘λ‹µμ΄ μΊμ‹λ΅λ¶€ν„° μ „λ‹¬λμ—λ”μ§€μ— λ€ν• μ •λ³΄λ¥Ό μ κ³µν•λ‹¤.

  - `X-Cache: hit` : μ‘λ‹µμ΄ μΊμ‹λ΅λ¶€ν„° μ „λ‹¬λμ—λ‹¤.
  - `X-Cache: miss` : μΊμ‹κ°€ μ”μ²­μ ν‚¤μ— λ€ν• μ‘λ‹µμ„ κ°–κ³  μμ§€ μ•κΈ°μ— μ›λ³Έ μ„λ²„λ΅λ¶€ν„° κ°€μ Έμ™”λ‹¤. λ€λ¶€λ¶„μ κ²½μ°μ—λ” κ·Έ λ‹¤μμ— μΊμ‹λ¥Ό ν•λ‹¤. μ΄λ¥Ό ν™•μΈν•κΈ° μ„ν•΄μ„λ” μ”μ²­μ„ λ‹¤μ‹ λ³΄λ‚΄μ–΄ κ°’μ΄ hitλ΅ μ—…λ°μ΄νΈ λμ—λ”μ§€λ¥Ό λ³΄λ©΄ λλ‹¤.
  - `X-Cache: dynamic` : μ›λ³Έ μ„λ²„κ°€ λ™μ μΌλ΅ μ½ν…μΈ λ¥Ό μƒμ„±ν–λ‹¤. μΌλ°μ μΌλ΅ μ΄λ” μ‘λ‹µμ΄ μΊμ‹±μ— μ ν•©ν•μ§€ μ•λ‹¤λ” κ²ƒμ„ μλ―Έν•λ‹¤.
  - `X-Cache: refresh` : μΊμ‹±λ μ½ν…μΈ μ κΈ°κ°„μ΄ λ§λ£λμ–΄ λ¦¬ν”„λ μ‹ν•κ±°λ‚ κ°±μ‹ μ΄ ν•„μ”ν•λ‹¤.

- `Cache-Control` ν—¤λ”μ—λ” μµλ€ μλ… `max-age`μ΄ 0λ³΄λ‹¤ λ” ν° `public`κ³Ό κ°™μ€ μΊμ‹±μ„ λ‚νƒ€λ‚΄λ” μ§€μ‹λ¬Έμ΄ ν¬ν•¨λ  μ μλ‹¤. μ΄λ” λ¦¬μ†μ¤κ°€ μΊμ‹± κ°€λ¥ν•λ‹¤λ” κ²ƒμ„ μ•”μ‹ν•  λΏμ΄λ‹¤. λν• ν•­μƒ μΊμ‹±μ„ λ‚νƒ€λ‚΄λ” κ²ƒμ΄ μ•„λ‹λ©°, μΊμ‹κ°€ μ΄ ν—¤λ”λ¥Ό λ¬΄μ‹ν•λ” κ²½μ°λ„ μλ‹¤.

<br>

λ§μΌ κ°™μ€ μ‘λ‹µμ— λ€ν•΄ μ‘λ‹µ μ‹κ°„μ— ν° μ°¨μ΄κ°€ μλ‹¤λ” κ²ƒμ„ μ•μ•„λ‚΄μ—λ‹¤λ©΄, μ΄λ” λ§μ°¬κ°€μ§€λ΅ λΉ λ¥Έ μ‘λ‹µμ΄ μΊμ‹λ΅λ¶€ν„° μ „λ‹¬λμ—μμ„ μ΄μ•ΌκΈ° ν•λ‹¤.

<br><br>

# #Explotiing static extension cache rules

---

μΊμ‹ λ£°μ€ `.css`λ‚ `.js`μ™€ κ°™μ€ ν”ν• νμΌ ν™•μ¥μλ¥Ό λ§¤μΉ­ν•¨μΌλ΅μ¨ μ •μ μΈ λ¦¬μ†μ¤λ¥Ό νƒ€κ²ν•κ³¤ ν•λ‹¤. μ΄λ” λ€λ¶€λ¶„μ CDNsμ—μ„ κΈ°λ³Έ λ™μ‘μ΄λ‹¤. λ§μΌ μΊμ‹μ™€ μ›λ³Έ μ„λ²„κ°€ URL κ²½λ΅λ¥Ό λ¦¬μ†μ¤μ— λ§¤ν•‘ν•κ±°λ‚ κµ¬λ¶„μλ¥Ό μ‚¬μ©ν•λ” λ°©μ‹μ— λ¨μμ΄ μ΅΄μ¬ν•λ‹¤λ©΄, κ³µκ²©μλ” μ›λ³Έ μ„λ²„μ— μν•΄ λ¬΄μ‹λμ§€λ§ μΊμ‹μ—μ„λ” λ³΄μ—¬μ§€λ” μ •μ μΈ ν™•μ¥μλ¥Ό κ°–λ” λ™μ μΈ λ¦¬μ†μ¤μ— λ€ν• μ”μ²­μ„ λ§λ“¤ μ μλ‹¤.

<br><br>

# #Using path mapping discrepancies

---

## Path mapping discrepancies

URL κ²½λ΅ λ§¤ν•‘μ€ URL κ²½λ΅λ¥Ό νμΌ, μ¤ν¬λ¦½νΈ, λ…λ Ήμ–΄ μ‹¤ν–‰κ³Ό κ°™μ΄ μ„λ²„μ λ¦¬μ†μ¤μ— μ—°κ΄€ μ‹ν‚¤λ” κ³Όμ •μ„ λ§ν•λ‹¤. λ‹¤μ–‘ν• ν”„λ μ„μ›ν¬μ™€ κΈ°μ μ— μν•΄ μ‚¬μ©λλ” λ‹¤μ–‘ν• λ²”μ„μ λ§¤ν•‘ μ¤νƒ€μΌμ΄ μ΅΄μ¬ν•λ‹¤. μ „ν†µμ μΈ URL λ§¤ν•‘κ³Ό RESTful URL λ§¤ν•‘μ΄ ν”ν• λ§¤ν•‘ μ¤νƒ€μΌλ“¤μ΄λ‹¤.

<br>

μ „ν†µμ μΈ URL λ§¤ν•‘μ€ νμΌ μ‹μ¤ν… λ‚΄μ— μ„μΉν•λ” λ¦¬μ†μ¤λ΅ ν–¥ν•λ” μ§μ ‘μ μΈ κ²½λ΅λ¥Ό λ‚νƒ€λ‚Έλ‹¤. λ‹¤μμ€ μΌλ°μ μΈ μμ‹μ΄λ‹¤.

`http://example.com/path/in/filesystem/resource.html`

- `http://example.com`μ€ μ„λ²„λ¥Ό κ°€λ¦¬ν‚¨λ‹¤.
- `/path/in/filesystem/`μ€ μ„λ²„μ νμΌ μ‹μ¤ν…μ— μλ” λ””λ ‰ν„°λ¦¬ κ²½λ΅λ¥Ό λ‚νƒ€λ‚Έλ‹¤.
- `resource.html`μ€ μ ‘κ·Ό λμ–΄μ§€λ” νΉμ •ν• νμΌμ΄λ‹¤.

<br>

λ€μ΅°μ μΌλ΅, REST μ¤νƒ€μΌμ URLλ“¤μ€ λ¬Όλ¦¬μ μΈ νμΌ κµ¬μ΅°μ— μ§μ ‘μ μΌλ΅ λ§¤μΉ­λμ§€ μ•λ”λ‹¤. μ΄λ“¤μ€ νμΌ κ²½λ΅λ¥Ό APIμ λ…Όλ¦¬μ μΈ λ¶€λ¶„μ— μ¶”μƒν™”ν•λ‹¤.

`http://example.com/path/resource/param1/param2`

- `http://example.com`μ€ μ„λ²„λ¥Ό κ°€λ¦¬ν‚¨λ‹¤.
- `/path/resource/`λ” λ¦¬μ†μ¤λ¥Ό λ‚νƒ€λ‚΄λ” μ—”λ“ν¬μΈνΈμ΄λ‹¤.
- `param1`κ³Ό `param2`λ” μ”μ²­μ„ μ²λ¦¬ν•κΈ° μ„ν•΄ μ„λ²„μ— μν•΄ μ‚¬μ©λλ” κ²½λ΅ νλΌλ―Έν„°μ΄λ‹¤.

<br><br>

μΊμ‹μ™€ μ›λ³Έ μ„λ²„κ°€ λ¦¬μ†μ† URL κ²½λ΅λ¥Ό λ§¤ν•‘ν•λ” λ°©λ²•μ—μ„μ λ¨μμ€ web cache deception μ·¨μ•½μ μ„ μ•ΌκΈ°ν•  μ μλ‹¤.

`http://example.com/user/123/profile/wcd.css`

- REST μ¤νƒ€μΌμ URL λ§¤ν•‘μ„ μ‚¬μ©ν•λ” μ›λ³Έ μ„λ²„λ” μ΄ URLμ„ `/user/123/profile` μ—”λ“ ν¬μΈνΈμ— λ€ν• μ”μ²­μΌλ΅ ν•΄μ„ν•  μ μκ³ , `wcd.css`λ¥Ό μ¤‘μ”ν•μ§€ μ•μ€ νλΌλ―Έν„°λΌκ³  μƒκ°ν•μ—¬ μ΄λ¥Ό λ¬΄μ‹ν•κ³  μ‚¬μ©μ `123`μ— λ€ν• ν”„λ΅ν•„ μ •λ³΄λ¥Ό λ°ν™ν•  μ μλ‹¤.

- μ „ν†µμ μΈ URL λ§¤ν•‘μ„ μ‚¬μ©ν•λ” μΊμ‹λ” μ΄λ¥Ό `/user/123` λ‚΄μ `/profile` λ””λ ‰ν„°λ¦¬μ— μ„μΉν• `wcd.css`λΌλ” μ΄λ¦„μ„ κ°€μ§„ νμΌμ— λ€ν• μ”μ²­μΌλ΅ κ°„μ£Όν•  μ μλ‹¤. μ΄λ” URL κ²½λ΅λ¥Ό `/user/123/profile/wcd.css`λ΅ ν•΄μ„ν•λ‹¤. λ§μΌ κ²½λ΅κ°€ `.css`λ΅ λλ‚λ” μ”μ²­μ— λ€ν• μ‘λ‹µμ„ μ €μ¥ν•λ„λ΅ κµ¬μ„±λμ–΄μ§„ κ²½μ°, μ΄λ” λ§μΉ CSS νμΌμ΄μ—λ κ²ƒμ²λΌ ν”„λ΅ν•„ μ •λ³΄λ¥Ό μΊμ‹±ν•κ³  μ „λ‹¬ν•λ‹¤.

<br><br>

## Exploiting path mapping discrepancies

μ›λ³Έ μ„λ²„κ°€ URL κ²½λ΅λ¥Ό λ¦¬μ†μ¤μ— λ§¤ν•‘ν•λ” λ°©λ²•μ„ ν…μ¤νΈν•κΈ° μ„ν•΄μ„λ”, μ„μμ κ²½λ΅ μ„Έκ·Έλ¨ΌνΈλ¥Ό νƒ€κ² μ—”λ“ν¬μΈνΈμ URLμ— μ¶”κ°€ν•΄μ•Ό ν•λ‹¤. λ§μΌ μ‘λ‹µμ΄ κΈ°λ³Έ μ‘λ‹µκ³Ό λ™μΌν• λ―Όκ°ν• λ°μ΄ν„°κ°€ μ—¬μ „ν ν¬ν•¨λμ–΄ μλ” κ²½μ°, μ΄λ” μ›λ³Έ μ„λ²„κ°€ URL κ²½λ΅λ¥Ό μ¶”μƒν™”ν•κ³  μ¶”κ°€λ μ„Έκ·Έλ¨ΌνΈλ¥Ό λ¬΄μ‹ν•λ‹¤λ” κ²ƒμ„ λ‚νƒ€λ‚Έλ‹¤. μλ¥Ό λ“¤μ–΄, `/api/orders/123`μ„ `/api/orders/123/foo`
λ΅ μμ •ν•΄λ„ μ£Όλ¬Έ μ •λ³΄κ°€ λ°ν™λλ” κ²½μ°κ°€ μλ‹¤.

<br>

μΊμ‹κ°€ URL κ²½λ΅λ¥Ό λ¦¬μ†μ¤μ— λ§¤ν•‘ν•λ” λ°©λ²•μ„ ν…μ¤νΈν•κΈ° μ„ν•΄μ„λ”, μ •μ μΈ ν™•μ¥μλ¥Ό μ¶”κ°€ν•¨μΌλ΅μ¨ μΊμ‹ λ£°μ— λ§¤μΉλλ„λ΅ κ²½λ΅λ¥Ό μμ •ν•΄μ•Ό ν•λ‹¤. μλ¥Ό λ“¤μ–΄, `/api/orders/123/foo`λ¥Ό `/api/orders/123/foo.js`λ΅ μ—…λ°μ΄νΈ ν•΄λΌ. λ§μ•½ μ‘λ‹µμ΄ μΊμ‹λλ©΄, 1) μΊμ‹κ°€ μ •μ μΈ ν™•μ¥μλ¥Ό κ°€μ§„ μ „μ²΄ URL κ²½λ΅λ¥Ό ν•΄μ„ν•λ‹¤λ” κ²ƒκ³Ό 2) `.js`λ΅ λλ‚λ” μ”μ²­μ— λ€ν• μ‘λ‹µμ„ μ €μ¥ν•κΈ° μ„ν• μΊμ‹ λ£°μ΄ μ΅΄μ¬ν•λ‹¤λ” κ²ƒμ„ μλ―Έν•λ‹¤.

μΊμ‹λ” νΉμ •ν• μ •μ μΈ ν™•μ¥μμ— κΈ°λ°ν• λ£°μ„ κ°€μ§€κ³  μμ„ κ²ƒμ΄κΈ°μ— `.css`, `.ico`, `.exe`λ¥Ό ν¬ν•¨ν• λ‹¤μ–‘ν• λ²”μ„μ ν™•μ¥μλ¥Ό μ‹λ„ν•΄λ³Ό μ μλ‹¤.

<br>

μ΄μ , μΊμ‹μ— μ €μ¥λλ” λ™μ μΈ μ‘λ‹µμ„ λ°ν™ν•λ” URLμ„ λ§λ“¤μ–΄ λ³Ό μ μλ‹¤. μ›λ³Έ μ„λ²„κ°€ λ‹¤μ–‘ν• μ—”λ“ν¬μΈνΈμ— λ€ν• λ‹¤μ–‘ν• μ¶”μƒν™” λ£°μ„ κ°€μ§€κ³  μκΈ° λ•λ¬Έμ—, μ΄ κ³µκ²©μ€ μ°λ¦¬κ°€ ν…μ¤νΈν• νΉμ • μ—”λ“ν¬μΈνΈμ—λ§ κµ­ν•λλ‹¤.

<br>

> Burp Scannerλ” μ¤μΊ” μ¤‘ κ²½λ΅ λ§¤ν•‘ λ¨μμ— μν•΄ λ°μƒν•λ” web cache deception μ·¨μ•½μ μ„ μλ™μΌλ΅ μ°Ύμ•„λ‚Ό μ μλ‹¤. Web Cache Deception Scanner BAppμ„ μ‚¬μ©ν•μ—¬ μλ» κµ¬μ„±λ μ›Ή μΊμ‹λ¥Ό μ°Ύμ•„λ‚Ό μλ„ μλ‹¤.
> {: .prompt-info}

<br><br>

## π©Lab: Exploiting path mapping for web cache deception

μ‚¬μ©μ `carlos`μ API ν‚¤λ¥Ό μ°Ύμ•„λ‚΄λ” λ¬Έμ μ΄λ‹¤. web cache deception μ·¨μ•½μ μ„ μ΄μ©ν•  μ μλ” λ¶€λ¶„μ„ μ°Ύμ•„λ³΄μ.

<br>

![image](https://github.com/user-attachments/assets/9cb8cd2a-4ea9-4ced-b70a-e50bcc361986)

μ°μ„  `wiener`μ κ³„μ •μΌλ΅ λ΅κ·ΈμΈν•κ³  `/my-account` κ²½λ΅μ— μ§„μ…ν•λ©΄ λ΅κ·ΈμΈν• κ³„μ •μΈ `wiener`μ API Keyλ¥Ό ν™•μΈν•  μ μλ‹¤. μ΄λ ‡κ² λ―Όκ°ν• λ°μ΄ν„°κ°€ λ…Έμ¶λλ” κ³³μ΄ μ·¨μ•½μ μ„ κ³µκ²©ν•  μ μλ” μ—”λ“ν¬μΈνΈκ°€ λλ‹¤.

<br>

μ΄μ  burp suiteμ—μ„ `/my-account` κ²½λ΅μ— μ„μμ ν•μ„ κ²½λ΅ `/foo`λ¥Ό μ¶”κ°€ν•μ—¬ `/my-account/foo`μ— μ”μ²­μ„ λ³΄λ‚΄λ³΄μ. μ”μ²­μ— λ€ν• μ‘λ‹µμ—μ„ μ—¬μ „ν API ν‚¤κ°€ μ „λ‹¬λλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤. μ΄λ” ν•μ„ μ„Έκ·Έλ¨ΌνΈμ— λ€ν•΄μ„ λ¬΄μ‹ν•λ‹¤λ” κ²ƒμ„ μ• μ μλ‹¤. κ·Έ λ‹¤μμΌλ΅ `/foo` κ²½λ΅ λ€μ‹  `/foo.js`λ¥Ό μ¶”κ°€ν•μ—¬ `/my-account/foo.js`μ— μ”μ²­μ„ λ³΄λ‚΄λ³΄μ.

<br>

![image](https://github.com/user-attachments/assets/506d6dc4-2ff0-48be-9548-4f52ee5a6ed4)

μ—¬μ „ν API ν‚¤λ¥Ό λ°ν™ν•λ” κ²ƒμ„ ν™•μΈν•  μ μμ„ λΏμ•„λ‹λΌ `Cache-Control: max-age=30` ν•„λ“μ™€ `X-cache: miss` ν•„λ“λ¥Ό ν™•μΈν•  μ μλ” κ²ƒμΌλ΅ λ³΄μ•„ ν•΄λ‹Ή νμ΄μ§€κ°€ μΊμ‹±λλ” κ²ƒμ„ μ• μ μλ‹¤.

<br>

![image](https://github.com/user-attachments/assets/43f90915-a3e1-4d9f-9a0e-0a4992854b82)

30μ΄ μ΄λ‚΄μ— λ‹¤μ‹ κ°™μ€ μ”μ²­μ„ λ³΄λ‚΄λ©΄ μ„μ™€ κ°™μ΄ `X-cache` ν•„λ“κ°€ `hit`λ΅ μ„¤μ •λ κ²ƒμ„ ν™•μΈν•  μ μλ‹¤. μ΄λ” ν„μ¬ μ‘λ‹µμ΄ μ„λ²„λ΅λ¶€ν„°κ°€ μ•„λ‹ μΊμ‹μ—μ„ κ°€μ Έμ¨ κ²ƒμ„μ„ μ• μ μλ‹¤.

**μ΄ νμ΄μ§€λ” μ›λ `wiener` κ³„μ •μΌλ΅ λ΅κ·ΈμΈν•μ—¬ `/my-account` κ²½λ΅μ— μ”μ²­μ„ λ³΄λ‚΄μ•Ό ν™•μΈν•  μ μλ” νμ΄μ§€μ΄μ§€λ§ λ΅κ·ΈμΈ ν•μ§€ μ•λ”λΌλ„ λ‹¤λ¥Έ μ‚¬μ©μκ°€ ν•΄λ‹Ή κ²½λ΅ `/my-account/foo.js`λ΅ μ”μ²­μ„ λ³΄λ‚΄λ©΄ μ”μ²­μ— λ€ν• μ‘λ‹µμ„ μ„λ²„κ°€ μ•„λ‹ μΊμ‹μ—μ„ κ°€μ Έμ¤κΈ° λ•λ¬Έμ— ν•΄λ‹Ή νμ΄μ§€λ¥Ό ν™•μΈν•  μ μλ‹¤.**

μ΄μ™€ κ°™μ΄ νƒ€κ² ν”Όν•΄μμΈ `carlos`κ°€ `/my-account/something.js` κ²½λ΅λ΅ μ”μ²­μ„ λ³΄λ‚΄κ² ν•λ©΄ `/my-account` νμ΄μ§€κ°€ μΊμ‹±λκ³ , μ΄λ¥Ό κ³µκ²©μκ°€ κ²½λ΅λ΅ μ”μ²­μ„ λ³΄λ‚΄λ©΄ ν•΄λ‹Ή νμ΄μ§€λ¥Ό ν™•μΈν•  μ μμΌλ©° μµμΆ…μ μΌλ΅ API Keyλ¥Ό νλ“ν•  μ μλ‹¤.

<br>

![image](https://github.com/user-attachments/assets/8b5f03d9-3579-4eab-84ce-a7d41333d833)

ν•΄λ‹Ή λ©μ—μ„ μ κ³µν•λ” *exploit server*λ¥Ό ν™μ©ν•μ—¬ carlosκ°€ urlμ— μ ‘μ†ν•  μ μλ„λ΅ νμ΄λ΅λ“λ¥Ό μ‘μ„±ν•μ. μ„μ™€ κ°™μ΄ `/my-account/foo.js` κ²½λ΅μ— μ ‘μ†ν•  μ μλ„λ΅ bodyμ— script νƒκ·Έλ¥Ό μ¶”κ°€ν•λ‹¤. payload μ €μ¥ ν›„ *Deliver exploit to victim*μ„ ν†µν•΄ μ „λ‹¬ν•λ‹¤.

<br>

![image](https://github.com/user-attachments/assets/ba210079-9de5-44b4-97da-5685d950cb5f)

λ°”λ΅ κ°™μ€ κ²½λ΅μ— μ”μ²­μ„ λ³΄λ‚΄λ©΄ μΊμ‹±λ νμ΄μ§€λ¥Ό ν™•μΈν•  μ μκ³ , `carlos`μ API Keyλ¥Ό νλ“ν•  μ μλ‹¤.

<br><br>
